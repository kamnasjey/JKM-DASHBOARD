{"openapi":"3.1.0","info":{"title":"JKM-AI-BOT API","version":"0.1.0"},"paths":{"/signals/":{"get":{"tags":["signals"],"summary":"Get Signals","description":"Get recent signals from scanner.\n\nParameters:\n- limit: Max signals to return (1-500)\n- symbol: Filter by symbol (e.g., EURUSD)\n- strategy_id: Filter by strategy\n- hours: Only signals from last N hours","operationId":"get_signals_signals__get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":500,"minimum":1,"default":50,"title":"Limit"}},{"name":"symbol","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Symbol"}},{"name":"strategy_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Strategy Id"}},{"name":"hours","in":"query","required":false,"schema":{"anyOf":[{"type":"integer","maximum":168,"minimum":1},{"type":"null"}],"title":"Hours"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/signals":{"get":{"tags":["signals"],"summary":"Get Signals","description":"Get recent signals from scanner.\n\nParameters:\n- limit: Max signals to return (1-500)\n- symbol: Filter by symbol (e.g., EURUSD)\n- strategy_id: Filter by strategy\n- hours: Only signals from last N hours","operationId":"get_signals_signals_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":500,"minimum":1,"default":50,"title":"Limit"}},{"name":"symbol","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Symbol"}},{"name":"strategy_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Strategy Id"}},{"name":"hours","in":"query","required":false,"schema":{"anyOf":[{"type":"integer","maximum":168,"minimum":1},{"type":"null"}],"title":"Hours"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/signals/latest":{"get":{"tags":["signals"],"summary":"Get Latest Signal","description":"Get the single most recent signal","operationId":"get_latest_signal_signals_latest_get","parameters":[{"name":"symbol","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Symbol"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/signals/stats":{"get":{"tags":["signals"],"summary":"Get Signal Stats","description":"Get signal statistics","operationId":"get_signal_stats_signals_stats_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/scan/start":{"post":{"tags":["scan"],"summary":"Start Scan","description":"Start continuous scanning.\n\nIMPORTANT: Only pass strategyId, NOT detector list.\nBackend will load detectors from strategy each cycle.","operationId":"start_scan_scan_start_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/StartScanRequestV2"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/scan/stop":{"post":{"tags":["scan"],"summary":"Stop Scan","description":"Stop continuous scanning.","operationId":"stop_scan_scan_stop_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/scan/status":{"get":{"tags":["scan"],"summary":"Get Scan Status","description":"Get current scanner status with full explainability.\n\nReturns:\n    ok, running, runId, startedAt, lastCycleAt, nextCycleAt,\n    config summary, detectors info, lastOutcome, counters, simVersion","operationId":"get_scan_status_scan_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/scan/results":{"get":{"tags":["scan"],"summary":"Get Scan Results","description":"Get latest scan results (setups found).\n\nIf no results, returns status explaining why:\n- Scanner not running\n- No setups matched criteria (with last root cause)","operationId":"get_scan_results_scan_results_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":100,"title":"Limit"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/health":{"get":{"summary":"Health","operationId":"health_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/signals":{"get":{"summary":"List Signals","description":"List signals with optional symbol filter. Newest first.\n\nData Source Priority:\n1. Firestore (via DashboardUserDataClient) - Primary\n2. signals.jsonl (local file) - Fallback","operationId":"list_signals_api_signals_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":500,"minimum":1,"default":50,"title":"Limit"}},{"name":"symbol","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by symbol (case-insensitive)","title":"Symbol"},"description":"Filter by symbol (case-insensitive)"},{"name":"include_outcomes","in":"query","required":false,"schema":{"type":"boolean","description":"Include SL/TP hit outcomes","default":true,"title":"Include Outcomes"},"description":"Include SL/TP hit outcomes"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"post":{"summary":"Append Signal","operationId":"append_signal_api_signals_post","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Payload"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/user-signals/{signal_id}":{"patch":{"summary":"Update User Signal Entry","description":"Update user tracking for a signal (e.g. entry taken).","operationId":"update_user_signal_entry_api_user_signals__signal_id__patch","parameters":[{"name":"signal_id","in":"path","required":true,"schema":{"type":"string","title":"Signal Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Payload"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/admin/resolve-user":{"get":{"summary":"Admin Resolve User","description":"Resolve backend user_id by email.\n\nThis is useful for ops (e.g., setting OWNER_ADMIN_USER_ID).\nNever crashes if DB is missing; returns ok:true with found=false.","operationId":"admin_resolve_user_api_admin_resolve_user_get","parameters":[{"name":"email","in":"query","required":true,"schema":{"type":"string","description":"User email to resolve to backend user_id","title":"Email"},"description":"User email to resolve to backend user_id"},{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/engine/status":{"get":{"summary":"Engine Status","description":"Return real scanner status (not EngineController's misleading state).","operationId":"engine_status_api_engine_status_get","parameters":[{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/engine/start":{"post":{"summary":"Engine Start","operationId":"engine_start_api_engine_start_post","parameters":[{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/engine/stop":{"post":{"summary":"Engine Stop","operationId":"engine_stop_api_engine_stop_post","parameters":[{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/engine/manual-scan":{"post":{"summary":"Engine Manual Scan","description":"Trigger a real scan cycle via scanner_service.scan_once().","operationId":"engine_manual_scan_api_engine_manual_scan_post","parameters":[{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/scan/manual-explain":{"post":{"summary":"Scan Manual Explain","description":"Run a one-off manual scan for a specific user and return a Telegram-ready explanation.\n\nPayload:\n  - user_id: str (required)\n  - symbols: list[str] (optional)","operationId":"scan_manual_explain_api_scan_manual_explain_post","parameters":[{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Payload"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/register":{"post":{"summary":"Auth Register","operationId":"auth_register_api_auth_register_post","parameters":[{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Payload"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/admin/backfill":{"post":{"summary":"Admin Backfill","description":"Run a short backfill job into /app/state/marketdata.\n\nIntended for ops validation (small ranges). Heavy multi-year backfills should\nuse scripts/backfill_market_data.py.\n\nPayload:\n  - symbol: str (required)\n  - timeframe: str (default: m5)\n  - days: int (default: 7)\n  - chunk_days: int (default: 1)","operationId":"admin_backfill_api_admin_backfill_post","parameters":[{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Payload"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/backtest":{"post":{"summary":"Run Backtest","description":"Run a simple backtest against historical signals.\n\nBody: {\n    \"strategy_id\": \"my_strategy\",  # optional: filter by strategy\n    \"detectors\": [\"range_box_edge\", \"sr_bounce\"],  # optional: filter signals that used these detectors\n    \"symbol\": \"XAUUSD\",  # optional: filter by symbol\n    \"days\": 30,  # optional: how many days back (default 30)\n}\n\nReturns statistics about matched signals.","operationId":"run_backtest_api_backtest_post","parameters":[{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Payload"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/backtest/simulate":{"post":{"summary":"Run Simulation Backtest","description":"Run a simulation backtest - run detectors on historical candle data.\n\nBody: {\n    \"strategy_id\": \"my_strategy\",  # optional: use strategy's detectors\n    \"detectors\": [\"range_box_edge\", \"sr_bounce\"],  # optional: specific detectors\n    \"symbol\": \"XAUUSD\",  # optional: specific symbol (default: all)\n    \"days\": 90,  # how many days back (default 90)\n    \"min_rr\": 2.0,  # minimum R:R filter (default 2.0)\n}\n\nProcess:\n1. Load historical candle data for the specified period\n2. Run selected detectors on each candle bar\n3. When detector fires, record entry/sl/tp\n4. Check if SL or TP was hit in subsequent candles\n5. Return win/loss statistics","operationId":"run_simulation_backtest_api_backtest_simulate_post","parameters":[{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Payload"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/outcomes":{"get":{"summary":"Get Outcomes Root","description":"Alias for /api/outcomes/stats to support frontend default path.","operationId":"get_outcomes_root_api_outcomes_get","parameters":[{"name":"days","in":"query","required":false,"schema":{"type":"integer","maximum":365,"minimum":1,"default":30,"title":"Days"}},{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/outcomes/stats":{"get":{"summary":"Get Outcomes Stats","description":"Get signal outcome statistics.\n\nReturns win/loss/pending counts and win rate.","operationId":"get_outcomes_stats_api_outcomes_stats_get","parameters":[{"name":"days","in":"query","required":false,"schema":{"type":"integer","maximum":365,"minimum":1,"default":30,"title":"Days"}},{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/outcomes/{signal_id}":{"get":{"summary":"Get Signal Outcome Api","description":"Get outcome for a specific signal.","operationId":"get_signal_outcome_api_api_outcomes__signal_id__get","parameters":[{"name":"signal_id","in":"path","required":true,"schema":{"type":"string","title":"Signal Id"}},{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/outcomes/check":{"post":{"summary":"Run Outcome Check Api","description":"Manually trigger outcome check for all pending signals.\n\nNote: Uses the market_cache singleton. If cache is empty, loads from file.","operationId":"run_outcome_check_api_api_outcomes_check_post","parameters":[{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/detectors":{"get":{"summary":"List Detectors","description":"List all available detectors with metadata.","operationId":"list_detectors_api_detectors_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/presets":{"get":{"summary":"List Presets","description":"List available strategy presets.","operationId":"list_presets_api_presets_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/signals/{signal_id}/explain":{"post":{"summary":"Explain Signal","description":"Generate AI explanation for a signal using OpenAI.\n\nReturns a detailed explanation in Mongolian about why this signal \nwas generated and what conditions were met.","operationId":"explain_signal_api_signals__signal_id__explain_post","parameters":[{"name":"signal_id","in":"path","required":true,"schema":{"type":"string","title":"Signal Id"}},{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/user/{user_id}/strategies":{"get":{"summary":"Get User Strategies","description":"Get user's saved strategies.","operationId":"get_user_strategies_api_user__user_id__strategies_get","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}},{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"post":{"summary":"Save User Strategies Endpoint","description":"Save user's strategies.\n\nBody: {\"strategies\": [...]}\nEach strategy should have:\n  - strategy_id: unique name\n  - enabled: true/false\n  - detectors: [\"detector1\", \"detector2\", ...]\n  - min_score: float (default 1.0)\n  - min_rr: float (default 2.0)\n  - allowed_regimes: [\"RANGE\", \"TREND_BULL\", \"TREND_BEAR\", \"CHOP\"]","operationId":"save_user_strategies_endpoint_api_user__user_id__strategies_post","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}},{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Payload"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"summary":"Delete User Strategies","description":"Delete all user strategies.","operationId":"delete_user_strategies_api_user__user_id__strategies_delete","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}},{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/user/{user_id}/strategies/from-preset/{preset_id}":{"post":{"summary":"Copy Preset To User","description":"Copy a preset to user's strategies.","operationId":"copy_preset_to_user_api_user__user_id__strategies_from_preset__preset_id__post","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}},{"name":"preset_id","in":"path","required":true,"schema":{"type":"string","title":"Preset Id"}},{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/strategies/shared":{"get":{"summary":"Get Shared Strategies","description":"Get all publicly shared strategies.\n\nReturns a list of strategies that users have shared with the community.","operationId":"get_shared_strategies_api_strategies_shared_get","parameters":[{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/user/{user_id}/strategies/share":{"post":{"summary":"Share Strategy","description":"Share a strategy to the public library.\n\nBody: {\n    \"strategy_id\": \"my_strategy_name\",\n    \"detectors\": [\"detector1\", \"detector2\"],\n    \"min_score\": 1.0,\n    \"min_rr\": 2.0,\n    \"allowed_regimes\": [\"RANGE\", \"TREND_BULL\"],\n    \"description\": \"Optional description of the strategy\"\n}","operationId":"share_strategy_api_user__user_id__strategies_share_post","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}},{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Payload"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/user/{user_id}/strategies/import/{share_id}":{"post":{"summary":"Import Shared Strategy","description":"Import a shared strategy to user's strategies.\n\nCopies the shared strategy into user's strategy list.","operationId":"import_shared_strategy_api_user__user_id__strategies_import__share_id__post","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}},{"name":"share_id","in":"path","required":true,"schema":{"type":"string","title":"Share Id"}},{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/user/{user_id}/strategies/shared/{share_id}":{"delete":{"summary":"Delete Shared Strategy","description":"Delete a strategy that user has shared.\n\nUser can only delete their own shared strategies.","operationId":"delete_shared_strategy_api_user__user_id__strategies_shared__share_id__delete","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}},{"name":"share_id","in":"path","required":true,"schema":{"type":"string","title":"Share Id"}},{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/telegram/connect-url":{"post":{"summary":"Telegram Connect Url","description":"Generate a Telegram deep link for user to connect their chat.\n\nPayload:\n  - user_id: str (required)\n\nReturns:\n  - ok: bool\n  - url: str (deep link to open bot with start token)","operationId":"telegram_connect_url_api_telegram_connect_url_post","parameters":[{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Payload"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/telegram/webhook":{"post":{"summary":"Telegram Webhook","description":"Telegram webhook endpoint for /start connect flow.\n\nQuery param:\n  - secret: must match TELEGRAM_WEBHOOK_SECRET","operationId":"telegram_webhook_api_telegram_webhook_post","parameters":[{"name":"secret","in":"query","required":false,"schema":{"type":"string","default":"","title":"Secret"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/telegram/status/{user_id}":{"get":{"summary":"Telegram Status","description":"Check Telegram connection status for a user.","operationId":"telegram_status_api_telegram_status__user_id__get","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}},{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/telegram/toggle/{user_id}":{"post":{"summary":"Telegram Toggle","description":"Enable/disable Telegram notifications for a user.\n\nPayload:\n  - enabled: bool","operationId":"telegram_toggle_api_telegram_toggle__user_id__post","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}},{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Payload"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/signals/{signal_id}":{"get":{"summary":"Get Signal Detail","description":"Get a single signal by ID from signals.jsonl.\n\nReturns 404 if not found.","operationId":"get_signal_detail_api_signals__signal_id__get","parameters":[{"name":"signal_id","in":"path","required":true,"schema":{"type":"string","title":"Signal Id"}},{"name":"user_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Optional user_id filter","title":"User Id"},"description":"Optional user_id filter"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/symbols":{"get":{"summary":"Get Symbols","description":"Return all tradeable symbols (canonical 15-symbol list).","operationId":"get_symbols_api_symbols_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/markets/{symbol}/candles":{"get":{"summary":"Get Candles","description":"Return candles for chart rendering.\n\nReturns list of {time: epoch_sec, open, high, low, close}.","operationId":"get_candles_api_markets__symbol__candles_get","parameters":[{"name":"symbol","in":"path","required":true,"schema":{"type":"string","title":"Symbol"}},{"name":"tf","in":"query","required":false,"schema":{"type":"string","description":"Timeframe: M5, M15, H1, H4, D1","default":"M5","title":"Tf"},"description":"Timeframe: M5, M15, H1, H4, D1"},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":2000,"minimum":1,"default":500,"title":"Limit"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/metrics":{"get":{"summary":"Get Metrics","description":"Return simple signal metrics for dashboard cards.","operationId":"get_metrics_api_metrics_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/metrics/detailed":{"get":{"summary":"Get Detailed Metrics","description":"Return detailed performance metrics broken down by symbol, timeframe, and day.","operationId":"get_detailed_metrics_api_metrics_detailed_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/ws/status":{"get":{"summary":"Get Ws Status","description":"Get WebSocket connection status.","operationId":"get_ws_status_api_ws_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/strategy-sim/run":{"post":{"summary":"Run Strategy Simulator","description":"Run strategy simulation on historical data.\n\nSupports two modes:\n1. Single TF: timeframe = \"M5\" | \"M15\" | \"H1\" | \"H4\" | \"auto\"\n2. Multi TF:  timeframe = \"multi\" (runs 5m, 15m, 30m, 1h, 4h)","operationId":"run_strategy_simulator_api_strategy_sim_run_post","parameters":[{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Payload"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/strategy-sim/jobs/{job_id}":{"get":{"summary":"Get Strategy Sim Job","operationId":"get_strategy_sim_job_api_strategy_sim_jobs__job_id__get","parameters":[{"name":"job_id","in":"path","required":true,"schema":{"type":"string","title":"Job Id"}},{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/strategy-sim/queue":{"get":{"summary":"Get Strategy Sim Queue","operationId":"get_strategy_sim_queue_api_strategy_sim_queue_get","parameters":[{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/strategy-sim/symbols":{"get":{"summary":"Get Simulator Symbols","description":"Get available symbols from cache for simulator.","operationId":"get_simulator_symbols_api_strategy_sim_symbols_get","parameters":[{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/strategy-tester/run":{"post":{"summary":"Run Strategy Tester","description":"[DEPRECATED] Use /api/strategy-sim/run instead.\n\nRun a strategy test with the configured detectors.\n\nRequest body:\n{\n    \"symbol\": \"XAUUSD\",\n    \"detectors\": [\"pinbar_at_level\", \"break_retest\"],\n    \"entry_tf\": \"M15\",\n    \"trend_tf\": \"H4\",\n    \"start_date\": \"2024-01-01\",  // optional\n    \"end_date\": \"2024-12-31\",    // optional\n    \"spread_pips\": 1.0,\n    \"slippage_pips\": 0.5,\n    \"commission_per_trade\": 0.0,\n    \"initial_capital\": 10000.0,\n    \"risk_per_trade_pct\": 1.0,\n    \"intrabar_policy\": \"sl_first\",  // sl_first, tp_first, bar_magnifier, random\n    \"min_rr\": 2.0,\n    \"min_score\": 1.0,\n    \"max_trades_per_day\": 10,\n    \"max_bars_in_trade\": 100\n}\n\nReturns:\n{\n    \"ok\": true,\n    \"run_id\": \"...\",\n    \"status\": \"completed\",\n    \"metrics\": {...},\n    \"trade_count\": 25,\n    \"duration_seconds\": 1.5\n}","operationId":"run_strategy_tester_api_strategy_tester_run_post","parameters":[{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Payload"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/strategy-tester/runs":{"get":{"summary":"List Tester Runs","description":"List all test runs.","operationId":"list_tester_runs_api_strategy_tester_runs_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":50,"title":"Limit"}},{"name":"offset","in":"query","required":false,"schema":{"type":"integer","default":0,"title":"Offset"}},{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/strategy-tester/runs/{run_id}":{"get":{"summary":"Get Tester Run","description":"Get a specific test run with full details.","operationId":"get_tester_run_api_strategy_tester_runs__run_id__get","parameters":[{"name":"run_id","in":"path","required":true,"schema":{"type":"string","title":"Run Id"}},{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"summary":"Delete Tester Run","description":"Delete a test run.","operationId":"delete_tester_run_api_strategy_tester_runs__run_id__delete","parameters":[{"name":"run_id","in":"path","required":true,"schema":{"type":"string","title":"Run Id"}},{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/strategy-tester/runs/{run_id}/trades":{"get":{"summary":"Get Tester Run Trades","description":"Get trades for a specific test run.","operationId":"get_tester_run_trades_api_strategy_tester_runs__run_id__trades_get","parameters":[{"name":"run_id","in":"path","required":true,"schema":{"type":"string","title":"Run Id"}},{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/strategy-tester/runs/{run_id}/equity":{"get":{"summary":"Get Tester Run Equity","description":"Get equity curve for a specific test run.","operationId":"get_tester_run_equity_api_strategy_tester_runs__run_id__equity_get","parameters":[{"name":"run_id","in":"path","required":true,"schema":{"type":"string","title":"Run Id"}},{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/market/feed/status":{"get":{"summary":"Get Market Feed Status","description":"Return comprehensive market feed health status.\n\nResponse:\n{\n  ok: true,\n  serverTime: iso,\n  provider: { name, healthy },\n  items: [{ symbol, tf, lastCandleTs, ageSec, nextDueAt, lagSec, backoffSec, lastError }],\n  worst: { symbol, tf, ageSec, lagSec },\n  simVersion\n}","operationId":"get_market_feed_status_api_market_feed_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/feed/status":{"get":{"summary":"Get Market Feed Status Alias","operationId":"get_market_feed_status_alias_api_feed_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/internal/marketdata/lag":{"get":{"summary":"Get Internal Marketdata Lag","description":"Internal endpoint for SLA monitoring.\n\nReturns per-symbol lag with SLA compliance status.\nRequires INTERNAL_API_KEY header.","operationId":"get_internal_marketdata_lag_api_internal_marketdata_lag_get","parameters":[{"name":"x-internal-api-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Internal-Api-Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/market/feed/refresh":{"post":{"summary":"Refresh Market Feed","description":"Force refresh market data for a symbol/tf.\nIf no params, refreshes all.","operationId":"refresh_market_feed_api_market_feed_refresh_post","parameters":[{"name":"symbol","in":"query","required":false,"schema":{"type":"string","description":"Symbol to refresh (optional)","title":"Symbol"},"description":"Symbol to refresh (optional)"},{"name":"tf","in":"query","required":false,"schema":{"type":"string","description":"Timeframe to refresh (optional)","title":"Tf"},"description":"Timeframe to refresh (optional)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/feed/refresh":{"post":{"summary":"Refresh Market Feed Alias","operationId":"refresh_market_feed_alias_api_feed_refresh_post","parameters":[{"name":"symbol","in":"query","required":false,"schema":{"type":"string","description":"Symbol to refresh (optional)","title":"Symbol"},"description":"Symbol to refresh (optional)"},{"name":"tf","in":"query","required":false,"schema":{"type":"string","description":"Timeframe to refresh (optional)","title":"Tf"},"description":"Timeframe to refresh (optional)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/simulator/contract":{"get":{"summary":"Get Simulator Contract","description":"Returns the expected response schema for simulator endpoint.\nUsed for contract verification and documentation.","operationId":"get_simulator_contract_api_simulator_contract_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"StartScanRequestV2":{"properties":{"strategyId":{"type":"string","title":"Strategyid"},"userId":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Userid"},"symbols":{"items":{"type":"string"},"type":"array","title":"Symbols"},"timeframes":{"items":{"type":"string"},"type":"array","title":"Timeframes","default":["15m","1h","4h"]},"lookbackDays":{"type":"integer","title":"Lookbackdays","default":30},"intervalSec":{"type":"integer","title":"Intervalsec","default":120},"maxPairsPerCycle":{"type":"integer","title":"Maxpairspercycle","default":50},"minRR":{"type":"number","title":"Minrr","default":1.5},"minConfirmHits":{"type":"integer","title":"Minconfirmhits","default":1},"minBarsScanned":{"type":"integer","title":"Minbarsscanned","default":50},"maxMissingPct":{"type":"number","title":"Maxmissingpct","default":30.0},"minConfidence":{"type":"number","title":"Minconfidence","default":0.4},"requireGate":{"type":"boolean","title":"Requiregate","default":true},"requireTrigger":{"type":"boolean","title":"Requiretrigger","default":true},"requireConfirm":{"type":"boolean","title":"Requireconfirm","default":false},"dedupeWindowMin":{"type":"integer","title":"Dedupewindowmin","default":60},"cooldownAfterSetupMin":{"type":"integer","title":"Cooldownaftersetupmin","default":30},"detectors":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Detectors"},"strategyName":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Strategyname"}},"type":"object","required":["strategyId","symbols"],"title":"StartScanRequestV2","description":"Request to start scanner - strategyId is required, detectors NOT sent"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}